<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나가노 크리스마스 여행</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- 모바일 컨테이너 -->
    <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl relative flex flex-col">
        
        <!-- 헤더 영역 (커스터마이징 가능) -->
        <header id="trip-header" class="relative h-64 bg-blue-600 flex items-end p-6 bg-cover bg-center transition-all duration-300 group cursor-pointer">
            <div class="absolute inset-0 bg-black bg-opacity-30 transition-opacity group-hover:bg-opacity-40"></div>
            <div class="relative z-10 w-full flex justify-between items-end">
                <div>
                    <h1 id="trip-title" class="text-3xl font-bold text-white drop-shadow-md">나가노 크리스마스 여행</h1>
                    <p class="text-white text-opacity-90 text-sm mt-1"><i class="far fa-calendar-alt mr-1"></i> 12.24 - 12.28 (4박 5일)</p>
                </div>
                <button onclick="openHeaderModal()" class="text-white opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-black bg-opacity-20 rounded-full">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- 날짜 탭 네비게이션 -->
        <nav class="sticky top-0 z-40 bg-white shadow-sm border-b border-gray-100 overflow-x-auto scrollbar-hide">
            <div class="flex px-2 py-3 space-x-2" id="day-tabs">
                <!-- 탭이 JS로 생성됩니다 -->
            </div>
        </nav>

        <!-- 메인 컨텐츠 영역 -->
        <main class="flex-1 p-4 pb-24 overflow-y-auto bg-gray-50" id="schedule-list">
            <!-- 일정 리스트가 JS로 생성됩니다 -->
        </main>

        <!-- 플로팅 추가 버튼 -->
        <button onclick="openAddModal()" class="fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-indigo-700 active:scale-95 transition-transform z-30">
            <i class="fas fa-plus text-xl"></i>
        </button>

    </div>

    <!-- 일정 추가/수정 모달 -->
    <div id="event-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 transition-opacity" onclick="closeModal('event-modal')"></div>
        <div class="absolute bottom-0 w-full max-w-md left-1/2 transform -translate-x-1/2 bg-white rounded-t-2xl p-6 transition-transform duration-300 translate-y-full" id="event-modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold" id="modal-title">새 일정 추가</h3>
                <button onclick="closeModal('event-modal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <form id="event-form" onsubmit="handleEventSubmit(event)">
                <input type="hidden" id="event-id">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">일차 선택</label>
                        <select id="event-day" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none" required>
                            <option value="1">1일차 (12/24)</option>
                            <option value="2">2일차 (12/25)</option>
                            <option value="3">3일차 (12/26)</option>
                            <option value="4">4일차 (12/27)</option>
                            <option value="5">5일차 (12/28)</option>
                        </select>
                    </div>

                    <div class="flex space-x-3">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">시간</label>
                            <input type="time" id="event-time" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">장소 / 활동</label>
                        <input type="text" id="event-title" placeholder="예: 도쿄역 출발" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">이동방법 / 메모</label>
                        <textarea id="event-note" placeholder="예: 신칸센 탑승 (QR코드 확인)" rows="2" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
                    </div>

                    <!-- 이미지 업로드 -->
                    <div>
                         <label class="block text-sm font-medium text-gray-700 mb-1">사진 첨부</label>
                         <div class="flex items-center space-x-2">
                            <label class="flex-1 cursor-pointer bg-gray-50 border border-gray-200 text-gray-500 rounded-xl p-3 text-center hover:bg-gray-100 transition">
                                <i class="fas fa-camera mr-2"></i>사진 선택
                                <input type="file" id="event-image-input" accept="image/*" class="hidden" onchange="previewImage(this)">
                            </label>
                         </div>
                         <div id="image-preview-area" class="mt-2 hidden">
                             <img id="image-preview" src="" class="w-full h-32 object-cover rounded-xl">
                             <button type="button" onclick="removeImage()" class="text-xs text-red-500 mt-1 underline">사진 삭제</button>
                         </div>
                    </div>
                </div>

                <div class="mt-8 flex space-x-3">
                    <button type="button" id="delete-btn" onclick="deleteEvent()" class="hidden w-1/3 py-3 bg-red-100 text-red-600 rounded-xl font-bold hover:bg-red-200 transition">삭제</button>
                    <button type="submit" id="save-btn" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-md hover:bg-indigo-700 transition">저장하기</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 헤더 설정 모달 -->
    <div id="header-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white rounded-2xl p-6 w-11/12 max-w-sm shadow-2xl">
            <h3 class="text-lg font-bold mb-4">여행 테마 설정</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-600 mb-1">여행 제목</label>
                    <input type="text" id="header-title-input" class="w-full p-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">글자 색상</label>
                    <input type="color" id="header-color-input" class="w-full h-10 p-1 border rounded-lg cursor-pointer">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">배경 이미지 URL</label>
                    <input type="text" id="header-bg-input" placeholder="https://..." class="w-full p-2 border rounded-lg text-sm">
                    <p class="text-xs text-gray-400 mt-1">* 이미지 주소를 입력하거나 비워두세요.</p>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-2">
                <button onclick="closeModal('header-modal')" class="px-4 py-2 text-gray-500">취소</button>
                <button onclick="saveHeaderSettings()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">적용</button>
            </div>
        </div>
    </div>

    <script>
        // --- 초기 데이터 (스프레드시트 내용 기반) ---
        const initialSchedule = [
            // 1일차
            { id: 101, day: 1, time: "15:50", title: "김포공항 국제선 터미널", note: "하네다행 비행기 탑승, 공항 집합", image: "" },
            { id: 102, day: 1, time: "17:50", title: "하네다 공항 도착", note: "nearme 택시 탑승", image: "" },
            { id: 103, day: 1, time: "20:00", title: "마루노우치 호텔 체크인", note: "모드레드 트윈룸*2 조식 포함 플랜", image: "" },
            // 2일차
            { id: 201, day: 2, time: "10:00", title: "체크아웃, 도시락 구매", note: "다이마루 도쿄 이용, 도보 이동", image: "" },
            { id: 202, day: 2, time: "11:00", title: "뷰 골드 라운지 (View Gold Lounge)", note: "八重洲中央口 개찰구 밖, 간판 없음", image: "" },
            { id: 203, day: 2, time: "12:04", title: "도쿄역 > 나가노 신칸센 탑승", note: "QR코드 확인", image: "" },
            { id: 204, day: 2, time: "14:00", title: "ORIX 렌터카 차량 수령", note: "나가노 도착 후 수령", image: "" },
            { id: 205, day: 2, time: "15:00", title: "소라 테라스 (SORA Terrace)", note: "차량 이동 1시간", image: "" },
            { id: 206, day: 2, time: "16:30", title: "노자와온센무라 (Nozawaonsen)", note: "차량 이동 40분", image: "" },
            { id: 207, day: 2, time: "18:00", title: "이이야마 유타키 온천", note: "차량 5분, 레스토랑 있음", image: "" },
            { id: 208, day: 2, time: "19:30", title: "에어비앤비 체크인", note: "〒382-0814, 차량 30분", image: "" },
            // 3일차
            { id: 301, day: 3, time: "11:00", title: "에어비앤비 출발", note: "", image: "" },
            { id: 302, day: 3, time: "12:00", title: "오가와 휴게소 (Roadside Station Ogawa)", note: "차량 이동 1시간", image: "" },
            { id: 303, day: 3, time: "13:00", title: "하쿠바 마운틴 하버", note: "곤돌라 탑승, 차량 30분", image: "" },
            { id: 304, day: 3, time: "14:30", title: "하쿠바 핫포 온천", note: "차량 5분", image: "" },
            { id: 305, day: 3, time: "15:00", title: "하쿠바마을 식사", note: "차량 5분", image: "" },
            { id: 306, day: 3, time: "16:30", title: "이케다 휴게소 (Road Station Ikeda)", note: "차량 45분", image: "" },
            { id: 307, day: 3, time: "17:30", title: "에어비앤비 체크인 (Vacation Home 和BISABI)", note: "체크아웃 4시 이후", image: "" },
            { id: 308, day: 3, time: "18:00", title: "이온몰 마츠모토", note: "저녁 식사, 차량 5분", image: "" },
            // 4일차
            { id: 401, day: 4, time: "10:00", title: "아가타노모리 공원", note: "도보 5분, 산책", image: "" },
            { id: 402, day: 4, time: "11:30", title: "비너스 언덕 코로봇코 휴테이", note: "차량 이동 1시간", image: "" },
            { id: 403, day: 4, time: "13:30", title: "스와코 휴게소 (Suwako Service Area)", note: "차량 40분", image: "" },
            { id: 404, day: 4, time: "15:00", title: "히루가미 온천 하나야 호텔 체크인", note: "오후 5시 이후 체크인시 전화 필수", image: "" },
            { id: 405, day: 4, time: "17:00", title: "호텔 저녁 식사", note: "", image: "" },
            { id: 406, day: 4, time: "19:00", title: "나이트 투어 (일본 제일의 별하늘)", note: "사전 예매 필요, 차량 10분", image: "" },
            // 5일차
            { id: 501, day: 5, time: "10:00", title: "호텔 체크아웃", note: "조식 8시 예상", image: "" },
            { id: 502, day: 5, time: "10:30", title: "쿠로스와의 숲 (Clasuwa no Mori)", note: "차량 30분", image: "" },
            { id: 503, day: 5, time: "12:00", title: "마츠모토 성 관람", note: "차량 1시간", image: "" },
            { id: 504, day: 5, time: "14:00", title: "ORIX 렌터카 차량 반납", note: "나가노역 근처", image: "" },
            { id: 505, day: 5, time: "14:26", title: "나가노 > 도쿄역 신칸센 탑승", note: "", image: "" },
            { id: 506, day: 5, time: "15:52", title: "도쿄역 도착", note: "", image: "" },
            { id: 507, day: 5, time: "16:30", title: "하네다 공항 이동", note: "야에스구치에서 택시 탑승", image: "" },
            { id: 508, day: 5, time: "20:05", title: "하네다 > 김포 비행기 탑승", note: "", image: "" }
        ];

        // --- 앱 상태 관리 ---
        let scheduleData = JSON.parse(localStorage.getItem('trip_schedule')) || initialSchedule;
        let currentDay = 1;
        let tempImageBase64 = ""; // 이미지 업로드 임시 저장소
        
        // 헤더 설정 불러오기
        const headerSettings = JSON.parse(localStorage.getItem('trip_header')) || {
            title: "나가노 크리스마스 여행",
            color: "#ffffff",
            bgImage: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=2070&auto=format&fit=crop"
        };

        // --- 초기화 ---
        function init() {
            applyHeaderSettings();
            renderTabs();
            renderSchedule();
        }

        // --- 렌더링 함수들 ---
        function applyHeaderSettings() {
            const header = document.getElementById('trip-header');
            const title = document.getElementById('trip-title');
            
            title.innerText = headerSettings.title;
            title.style.color = headerSettings.color;
            if (headerSettings.bgImage) {
                header.style.backgroundImage = `url('${headerSettings.bgImage}')`;
            } else {
                header.style.backgroundImage = 'none';
                header.classList.add('bg-blue-600');
            }
        }

        function renderTabs() {
            const tabContainer = document.getElementById('day-tabs');
            tabContainer.innerHTML = '';
            
            // 날짜 계산 (12/24 시작)
            const startDate = new Date(2025, 11, 24); // Month is 0-indexed (11 = Dec)

            for (let i = 1; i <= 5; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + (i - 1));
                const dateStr = `${date.getMonth() + 1}.${date.getDate()}`;
                const isActive = currentDay === i;
                
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-5 py-2 rounded-full text-sm font-medium transition-all ${
                    isActive 
                    ? 'bg-black text-white shadow-md transform scale-105' 
                    : 'bg-white text-gray-500 border border-gray-200 hover:bg-gray-50'
                }`;
                btn.innerHTML = `<span class="block text-xs opacity-70">${dateStr}</span>${i}일차`;
                btn.onclick = () => { currentDay = i; renderTabs(); renderSchedule(); };
                tabContainer.appendChild(btn);
            }
        }

        function renderSchedule() {
            const listContainer = document.getElementById('schedule-list');
            listContainer.innerHTML = '';

            // 현재 일차 데이터 필터링 및 시간순 정렬
            const dayEvents = scheduleData
                .filter(item => parseInt(item.day) === currentDay)
                .sort((a, b) => a.time.localeCompare(b.time));

            if (dayEvents.length === 0) {
                listContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                        <i class="far fa-calendar-times text-4xl mb-3"></i>
                        <p>등록된 일정이 없습니다.</p>
                    </div>`;
                return;
            }

            dayEvents.forEach((event, index) => {
                const isLast = index === dayEvents.length - 1;
                
                // 구글 맵 링크 생성
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.title)}`;

                const card = document.createElement('div');
                card.className = "flex relative group";
                card.innerHTML = `
                    <!-- 타임라인 라인 -->
                    <div class="mr-4 flex flex-col items-center">
                        <div class="w-3 h-3 bg-indigo-500 rounded-full mt-6 z-10 ring-4 ring-white"></div>
                        ${!isLast ? '<div class="w-0.5 h-full bg-gray-200 -mt-2"></div>' : ''}
                    </div>
                    
                    <!-- 카드 내용 -->
                    <div class="flex-1 pb-6 cursor-pointer" onclick="openEditModal(${event.id})">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-1">
                                <span class="text-indigo-600 font-bold text-lg">${event.time}</span>
                            </div>
                            
                            <h3 class="text-gray-900 font-bold text-lg mb-1 hover:text-indigo-600 transition" onclick="event.stopPropagation(); window.open('${mapLink}', '_blank')">
                                ${event.title} <i class="fas fa-external-link-alt text-xs text-gray-400 ml-1"></i>
                            </h3>
                            
                            ${event.note ? `<p class="text-gray-500 text-sm bg-gray-50 p-2 rounded-lg mt-2"><i class="fas fa-info-circle mr-1 text-xs"></i>${event.note}</p>` : ''}
                            
                            ${event.image ? `
                                <div class="mt-3 relative h-40 rounded-xl overflow-hidden group-hover:opacity-90 transition">
                                    <img src="${event.image}" class="w-full h-full object-cover" alt="일정 사진">
                                </div>
                            ` : ''}

                            <div class="mt-3 flex justify-end">
                                <span class="text-xs text-gray-300 font-medium group-hover:text-indigo-400 transition">수정하려면 터치</span>
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        // --- 모달 및 로직 ---
        function openAddModal() {
            resetForm();
            document.getElementById('modal-title').innerText = "새 일정 추가";
            document.getElementById('event-day').value = currentDay;
            document.getElementById('save-btn').innerText = "추가하기";
            document.getElementById('delete-btn').classList.add('hidden');
            document.getElementById('save-btn').classList.replace('w-2/3', 'w-full');
            
            openModal('event-modal');
        }

        function openEditModal(id) {
            const event = scheduleData.find(item => item.id === id);
            if (!event) return;

            document.getElementById('event-id').value = event.id;
            document.getElementById('event-day').value = event.day;
            document.getElementById('event-time').value = event.time;
            document.getElementById('event-title').value = event.title;
            document.getElementById('event-note').value = event.note;
            
            // 이미지 미리보기 설정
            tempImageBase64 = event.image || "";
            const previewArea = document.getElementById('image-preview-area');
            const previewImg = document.getElementById('image-preview');
            if (tempImageBase64) {
                previewImg.src = tempImageBase64;
                previewArea.classList.remove('hidden');
            } else {
                previewArea.classList.add('hidden');
            }

            document.getElementById('modal-title').innerText = "일정 수정";
            document.getElementById('save-btn').innerText = "수정 완료";
            
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            
            deleteBtn.classList.remove('hidden');
            saveBtn.classList.remove('w-full');
            saveBtn.classList.add('w-2/3');

            openModal('event-modal');
        }

        function handleEventSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('event-id').value;
            const day = parseInt(document.getElementById('event-day').value);
            const time = document.getElementById('event-time').value;
            const title = document.getElementById('event-title').value;
            const note = document.getElementById('event-note').value;

            if (id) {
                // 수정
                const index = scheduleData.findIndex(item => item.id == id);
                if (index !== -1) {
                    scheduleData[index] = { ...scheduleData[index], day, time, title, note, image: tempImageBase64 };
                }
            } else {
                // 추가
                const newId = Date.now();
                scheduleData.push({ id: newId, day, time, title, note, image: tempImageBase64 });
            }

            saveData();
            closeModal('event-modal');
            currentDay = day; // 수정/추가한 날짜로 이동
            renderTabs();
            renderSchedule();
        }

        function deleteEvent() {
            const id = document.getElementById('event-id').value;
            if (confirm('정말 이 일정을 삭제하시겠습니까?')) {
                scheduleData = scheduleData.filter(item => item.id != id);
                saveData();
                closeModal('event-modal');
                renderSchedule();
            }
        }

        // --- 헤더 설정 ---
        function openHeaderModal() {
            document.getElementById('header-title-input').value = headerSettings.title;
            document.getElementById('header-color-input').value = headerSettings.color;
            document.getElementById('header-bg-input').value = headerSettings.bgImage;
            openModal('header-modal');
        }

        function saveHeaderSettings() {
            headerSettings.title = document.getElementById('header-title-input').value;
            headerSettings.color = document.getElementById('header-color-input').value;
            headerSettings.bgImage = document.getElementById('header-bg-input').value;
            
            localStorage.setItem('trip_header', JSON.stringify(headerSettings));
            applyHeaderSettings();
            closeModal('header-modal');
        }

        // --- 이미지 처리 ---
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempImageBase64 = e.target.result;
                    document.getElementById('image-preview').src = tempImageBase64;
                    document.getElementById('image-preview-area').classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeImage() {
            tempImageBase64 = "";
            document.getElementById('image-preview-area').classList.add('hidden');
            document.getElementById('event-image-input').value = "";
        }

        // --- 공통 유틸리티 ---
        function saveData() {
            localStorage.setItem('trip_schedule', JSON.stringify(scheduleData));
        }

        function openModal(id) {
            const modal = document.getElementById(id);
            const content = modal.querySelector('div[class*="translate-y-full"]') || modal.querySelector('div');
            modal.classList.remove('hidden');
            setTimeout(() => {
                if(content.classList.contains('translate-y-full')) {
                    content.classList.remove('translate-y-full');
                }
            }, 10);
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            const content = modal.querySelector('div[class*="transition-transform"]');
            
            if (content && !content.classList.contains('translate-y-full')) {
                content.classList.add('translate-y-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            } else {
                modal.classList.add('hidden');
            }
        }

        function resetForm() {
            document.getElementById('event-form').reset();
            document.getElementById('event-id').value = "";
            tempImageBase64 = "";
            document.getElementById('image-preview-area').classList.add('hidden');
        }

        // 앱 실행
        init();

    </script>
</body>
</html>