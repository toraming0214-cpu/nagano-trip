import React, { useState, useEffect } from 'react';
import { 
  Plane, Train, Car, Hotel, MapPin, Utensils, Clock, 
  Calendar, Coffee, Mountain, Star, ExternalLink, 
  Edit2, Plus, Trash2, X, Save, RotateCcw, Settings
} from 'lucide-react';

// --- ì´ˆê¸° ë°ì´í„° (Default Data) ---
const INITIAL_DATA = [
  {
    day: 1,
    date: '12/24 (í™”)',
    title: 'ë„ì¿„ ë„ì°© & í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë¸Œ',
    events: [
      { id: 101, time: '15:50', endTime: '17:50', title: 'ê¹€í¬ê³µí•­ ì¶œë°œ â†’ í•˜ë„¤ë‹¤ ë„ì°©', location: 'ê¹€í¬ê³µí•­ êµ­ì œì„  / í•˜ë„¤ë‹¤ ê³µí•­', mapQuery: 'Haneda Airport', type: 'flight', note: 'ê³µí•­ ì§‘í•©, í•˜ë„¤ë‹¤ ë„ì°© í›„ NearMe íƒì‹œ íƒ‘ìŠ¹' },
      { id: 102, time: '20:00', endTime: '', title: 'í˜¸í…” ì²´í¬ì¸', location: 'ë§ˆë£¨ë…¸ìš°ì¹˜ í˜¸í…”', mapQuery: 'Marunouchi Hotel Tokyo', type: 'hotel', note: 'ëª¨ë“œë ˆë“œ íŠ¸ìœˆ 2 (ì¡°ì‹ í¬í•¨)' }
    ]
  },
  {
    day: 2,
    date: '12/25 (ìˆ˜)',
    title: 'ë‚˜ê°€ë…¸ë¡œ ì´ë™ & ì˜¨ì²œ ì—¬í–‰',
    events: [
      { id: 201, time: '10:00', endTime: '', title: 'ì²´í¬ì•„ì›ƒ & ë„ì‹œë½ êµ¬ë§¤', location: 'ë‹¤ì´ë§ˆë£¨ ë„ì¿„', mapQuery: 'Daimaru Tokyo', type: 'food', note: 'ë„ë³´ ì´ë™' },
      { id: 202, time: '11:00', endTime: '', title: 'ë·° ê³¨ë“œ ë¼ìš´ì§€ ë°©ë¬¸', location: 'ë„ì¿„ì—­ ë·° ê³¨ë“œ ë¼ìš´ì§€', mapQuery: 'View Gold Lounge Tokyo Station', type: 'coffee', note: 'ì•¼ì—ìŠ¤ ì¤‘ì•™êµ¬ ê°œì°°êµ¬ ë°– 18ë²ˆ' },
      { id: 203, time: '12:04', endTime: '', title: 'ì‹ ì¹¸ì„¼ íƒ‘ìŠ¹ (ë„ì¿„ â†’ ë‚˜ê°€ë…¸)', location: 'ë„ì¿„ì—­', mapQuery: 'Tokyo Station', type: 'train', note: 'QRì½”ë“œ í™•ì¸ í•„ìˆ˜' },
      { id: 204, time: '14:00', endTime: '', title: 'ë Œí„°ì¹´ ìˆ˜ë ¹', location: 'ORIX ë Œí„°ì¹´ ë‚˜ê°€ë…¸ì—­', mapQuery: 'Orix Rent-a-car Nagano Station', type: 'car', note: 'ë„ë³´ ì´ë™' },
      { id: 205, time: '15:00', endTime: '', title: 'ì†Œë¼ í…Œë¼ìŠ¤ (SORA Terrace) ì´ë™', location: 'SORA terrace', mapQuery: 'SORA terrace Nagano', type: 'mountain', note: 'ì°¨ëŸ‰ ì´ë™ ì•½ 1ì‹œê°„' },
      { id: 206, time: '16:30', endTime: '', title: 'ë…¸ìì™€ ì˜¨ì„¼ ì´ë™', location: 'Nozawaonsen', mapQuery: 'Nozawaonsen', type: 'car', note: 'ì°¨ëŸ‰ ì´ë™ 40ë¶„' },
      { id: 207, time: '18:00', endTime: '', title: 'ì´ì´ì•¼ë§ˆ ìœ íƒ€í‚¤ ì˜¨ì²œ', location: 'Iiyama Yutaki Onsen', mapQuery: 'Iiyama Yutaki Onsen', type: 'water', note: 'ë…¸ìì™€ë¬´ë¼ì—ì„œ ì°¨ë¡œ 5ë¶„' },
      { id: 208, time: '19:30', endTime: '', title: 'ì—ì–´ë¹„ì•¤ë¹„ ì²´í¬ì¸', location: 'ìˆ™ì†Œ (ë‚˜ê°€ë…¸)', mapQuery: '382-0814 Nagano', type: 'hotel', note: 'ì°¨ëŸ‰ ì´ë™ 5ë¶„' }
    ]
  },
  {
    day: 3,
    date: '12/26 (ëª©)',
    title: 'í•˜ì¿ ë°” & ë§ˆì¸ ëª¨í†  ì‚°ì±…',
    events: [
      { id: 301, time: '11:00', endTime: '', title: 'ìˆ™ì†Œ ì¶œë°œ', location: 'ì—ì–´ë¹„ì•¤ë¹„', mapQuery: '', type: 'car', note: '' },
      { id: 302, time: '12:00', endTime: '', title: 'íœ´ê²Œì†Œ íœ´ì‹', location: 'ë¯¸ì¹˜ë…¸ì—í‚¤ ì˜¤ê°€ì™€', mapQuery: 'Roadside Station Ogawa', type: 'coffee', note: 'ì°¨ëŸ‰ ì´ë™ 30ë¶„' },
      { id: 303, time: '13:00', endTime: '', title: 'í•˜ì¿ ë°” ë§ˆìš´í‹´ í•˜ë²„', location: 'Hakuba Iwatake Mountain Resort', mapQuery: 'Hakuba Iwatake Mountain Resort', type: 'mountain', note: 'ê³¤ëŒë¼ íƒ‘ìŠ¹, ì°¨ëŸ‰ ì´ë™ 1ì‹œê°„' },
      { id: 304, time: '14:30', endTime: '', title: 'í•˜ì¿ ë°” í•«í¬ ì˜¨ì²œ & ì ì‹¬', location: 'Hakuba Happo Onsen', mapQuery: 'Hakuba Happo Onsen', type: 'water', note: 'í•˜ì¿ ë°” ë§ˆì„ ì‹ì‚¬' },
      { id: 305, time: '16:30', endTime: '', title: 'íœ´ê²Œì†Œ íœ´ì‹', location: 'ë¯¸ì¹˜ë…¸ì—í‚¤ ì´ì¼€ë‹¤', mapQuery: 'Road Station Ikeda', type: 'coffee', note: 'ì°¨ëŸ‰ ì´ë™ 45ë¶„' },
      { id: 306, time: '17:30', endTime: '', title: 'ì—ì–´ë¹„ì•¤ë¹„ ì²´í¬ì¸', location: 'Vacation Home å’ŒBISABI', mapQuery: 'Vacation Home Wabisa-bi', type: 'hotel', note: 'ì°¨ëŸ‰ ì´ë™ 35ë¶„, ì²´í¬ì•„ì›ƒ 4ì‹œ ì´í›„' },
      { id: 307, time: '18:00', endTime: '', title: 'ì €ë… ì‹ì‚¬ & ì‡¼í•‘', location: 'Aeon Mall Matsumoto', mapQuery: 'Aeon Mall Matsumoto', type: 'food', note: 'ì°¨ëŸ‰ ì´ë™ 5ë¶„' }
    ]
  },
  {
    day: 4,
    date: '12/27 (ê¸ˆ)',
    title: 'ë¹„ë„ˆìŠ¤ ë¼ì¸ & ë³„ë³´ê¸° íˆ¬ì–´',
    events: [
      { id: 401, time: '10:00', endTime: '', title: 'ì•„ê°€íƒ€ë…¸ëª¨ë¦¬ ê³µì› ì‚°ì±…', location: 'Agatanomori Park', mapQuery: 'Agatanomori Park', type: 'map', note: 'ì²´í¬ì•„ì›ƒ 10ì‹œ ì´ì „' },
      { id: 402, time: '11:30', endTime: '', title: 'ë¹„ë„ˆìŠ¤ ë¼ì¸ / ì½”ë¡œë´‡ì¿ ë£¨ íœ´í…Œ', location: 'Korobokkuru Hutte', mapQuery: 'Korobokkuru Hutte', type: 'mountain', note: 'ì°¨ëŸ‰ ì´ë™ 1ì‹œê°„' },
      { id: 403, time: '13:30', endTime: '', title: 'íœ´ê²Œì†Œ íœ´ì‹', location: 'ìŠ¤ì™€ì½” ì„œë¹„ìŠ¤ ì—ì–´ë¦¬ì–´', mapQuery: 'Suwako Service Area', type: 'coffee', note: 'ì°¨ëŸ‰ ì´ë™ 40ë¶„' },
      { id: 404, time: '15:00', endTime: '', title: 'ë£Œì¹¸ ì²´í¬ì¸', location: 'íˆë£¨ê°€ë¯¸ ì˜¨ì²œ (Hotel Hanaya)', mapQuery: 'Hirugami Onsen Hotel Hanaya', type: 'hotel', note: 'ì˜¤í›„ 5ì‹œ ì´í›„ ì²´í¬ì¸ ì‹œ ì‚¬ì „ ì—°ë½ í•„ìˆ˜' },
      { id: 405, time: '17:00', endTime: '', title: 'ë£Œì¹¸ ì €ë… ì‹ì‚¬', location: 'Hotel Hanaya', mapQuery: 'Hirugami Onsen Hotel Hanaya', type: 'food', note: '' },
      { id: 406, time: '19:00', endTime: '', title: 'ì²œê³µì˜ ë‚™ì› ë‚˜ì´íŠ¸ íˆ¬ì–´', location: 'Fujimidai Kogen Ropeway', mapQuery: 'Fujimidai Kogen Ropeway', type: 'star', note: 'ì¼ë³¸ ìµœê³ ì˜ ë³„ë³´ê¸° íˆ¬ì–´ (ì‚¬ì „ ì˜ˆë§¤ í•„ìš”)' }
    ]
  },
  {
    day: 5,
    date: '12/28 (í† )',
    title: 'ì—¬í–‰ ë§ˆë¬´ë¦¬ & ê·€êµ­',
    events: [
      { id: 501, time: '10:00', endTime: '', title: 'ì²´í¬ì•„ì›ƒ', location: 'Hotel Hanaya', mapQuery: 'Hirugami Onsen Hotel Hanaya', type: 'hotel', note: 'ì¡°ì‹ 8ì‹œ ì˜ˆìƒ' },
      { id: 502, time: '10:30', endTime: '', title: 'ì¿ ë¼ìŠ¤ì™€ë…¸ëª¨ë¦¬ ë°©ë¬¸', location: 'Clasuwa no Mori', mapQuery: 'Clasuwa no Mori', type: 'map', note: 'ì°¨ëŸ‰ ì´ë™ 30ë¶„' },
      { id: 503, time: '12:00', endTime: '', title: 'ë§ˆì¸ ëª¨í†  ì„± ê´€ëŒ', location: 'Matsumoto Castle', mapQuery: 'Matsumoto Castle', type: 'map', note: 'ì°¨ëŸ‰ ì´ë™ 1ì‹œê°„' },
      { id: 504, time: '14:00', endTime: '', title: 'ë Œí„°ì¹´ ë°˜ë‚©', location: 'ORIX ë Œí„°ì¹´ ë‚˜ê°€ë…¸ì—­', mapQuery: 'Orix Rent-a-car Nagano Station', type: 'car', note: 'ì°¨ëŸ‰ ì´ë™ 1ì‹œê°„' },
      { id: 505, time: '14:26', endTime: '', title: 'ì‹ ì¹¸ì„¼ íƒ‘ìŠ¹ (ë‚˜ê°€ë…¸ â†’ ë„ì¿„)', location: 'ë‚˜ê°€ë…¸ì—­', mapQuery: 'Nagano Station', type: 'train', note: 'ë„ë³´ 5ë¶„ ì´ë™' },
      { id: 506, time: '15:52', endTime: '', title: 'ë„ì¿„ì—­ ë„ì°©', location: 'ë„ì¿„ì—­', mapQuery: 'Tokyo Station', type: 'map', note: '' },
      { id: 507, time: '16:30', endTime: '', title: 'ê³µí•­ ì´ë™ (íƒì‹œ)', location: 'ì•¼ì—ìŠ¤êµ¬ì¹˜ íƒì‹œ ìŠ¹ê°•ì¥', mapQuery: 'Tokyo Station Yaesu Exit', type: 'car', note: 'NearMe íƒì‹œ íƒ‘ìŠ¹' },
      { id: 508, time: '20:05', endTime: '', title: 'í•˜ë„¤ë‹¤ ì¶œë°œ â†’ ê¹€í¬ ë„ì°©', location: 'í•˜ë„¤ë‹¤ ê³µí•­', mapQuery: 'Haneda Airport', type: 'flight', note: 'ì•ˆì „í•œ ê·€êµ­ ë˜ì„¸ìš”!' }
    ]
  }
];

// --- ì•„ì´ì½˜ ë§¤í•‘ ---
const ICON_TYPES = [
  { id: 'flight', label: 'ë¹„í–‰ê¸°', icon: Plane, color: 'bg-blue-100 text-blue-600' },
  { id: 'train', label: 'ê¸°ì°¨', icon: Train, color: 'bg-green-100 text-green-600' },
  { id: 'car', label: 'ì°¨ëŸ‰', icon: Car, color: 'bg-orange-100 text-orange-600' },
  { id: 'hotel', label: 'ìˆ™ì†Œ', icon: Hotel, color: 'bg-purple-100 text-purple-600' },
  { id: 'food', label: 'ì‹ì‚¬', icon: Utensils, color: 'bg-red-100 text-red-600' },
  { id: 'coffee', label: 'ì¹´í˜/íœ´ì‹', icon: Coffee, color: 'bg-amber-100 text-amber-700' },
  { id: 'mountain', label: 'ìì—°/ê´€ê´‘', icon: Mountain, color: 'bg-emerald-100 text-emerald-600' },
  { id: 'star', label: 'ë³„ë³´ê¸°/ë°¤', icon: Star, color: 'bg-yellow-100 text-yellow-600' },
  { id: 'map', label: 'ì¥ì†Œ', icon: MapPin, color: 'bg-gray-100 text-gray-600' },
  { id: 'water', label: 'ì˜¨ì²œ', icon: null, custom: 'â™¨ï¸', color: 'bg-pink-100 text-pink-600' },
];

export default function NaganoTripAppEditable() {
  const [activeDay, setActiveDay] = useState(1);
  const [scheduleData, setScheduleData] = useState([]);
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);
  const [editingEvent, setEditingEvent] = useState(null);
  const [isSettingsOpen, setIsSettingsOpen] = useState(false);

  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ
  useEffect(() => {
    const savedData = localStorage.getItem('naganoTripData');
    if (savedData) {
      setScheduleData(JSON.parse(savedData));
    } else {
      setScheduleData(INITIAL_DATA);
    }
  }, []);

  // ë°ì´í„° ì €ì¥
  const saveToStorage = (newData) => {
    setScheduleData(newData);
    localStorage.setItem('naganoTripData', JSON.stringify(newData));
  };

  // ì´ˆê¸°í™”
  const handleReset = () => {
    if (window.confirm('ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ì§€ìš°ê³  ì²˜ìŒ ì¼ì •ìœ¼ë¡œ ë˜ëŒë¦´ê¹Œìš”?')) {
      saveToStorage(INITIAL_DATA);
      setIsSettingsOpen(false);
    }
  };

  // ì¥ì†Œ í´ë¦­ (êµ¬ê¸€ë§µ)
  const handleLocationClick = (query) => {
    if (!query) return;
    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
    window.open(url, '_blank', 'noopener,noreferrer');
  };

  // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
  const openEditModal = (event) => {
    setEditingEvent({ ...event }); // ë³µì‚¬ë³¸ ìƒì„±
    setIsEditModalOpen(true);
  };

  // ìƒˆ ì¼ì • ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
  const openAddModal = () => {
    setEditingEvent({
      id: Date.now(), // ì„ì‹œ ID
      time: '12:00',
      endTime: '',
      title: 'ìƒˆë¡œìš´ ì¼ì •',
      location: '',
      mapQuery: '',
      type: 'map',
      note: ''
    });
    setIsEditModalOpen(true);
  };

  // ì¼ì • ì €ì¥ (ìˆ˜ì •/ì¶”ê°€)
  const handleSaveEvent = () => {
    const newSchedule = [...scheduleData];
    const dayIndex = newSchedule.findIndex(d => d.day === activeDay);
    const dayData = newSchedule[dayIndex];
    
    const existingEventIndex = dayData.events.findIndex(e => e.id === editingEvent.id);

    if (existingEventIndex >= 0) {
      // ìˆ˜ì •
      dayData.events[existingEventIndex] = editingEvent;
    } else {
      // ì¶”ê°€
      dayData.events.push(editingEvent);
      // ì‹œê°„ìˆœ ì •ë ¬
      dayData.events.sort((a, b) => a.time.localeCompare(b.time));
    }

    newSchedule[dayIndex] = dayData;
    saveToStorage(newSchedule);
    setIsEditModalOpen(false);
  };

  // ì¼ì • ì‚­ì œ
  const handleDeleteEvent = () => {
    if (!window.confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    const newSchedule = [...scheduleData];
    const dayIndex = newSchedule.findIndex(d => d.day === activeDay);
    newSchedule[dayIndex].events = newSchedule[dayIndex].events.filter(e => e.id !== editingEvent.id);
    
    saveToStorage(newSchedule);
    setIsEditModalOpen(false);
  };

  const currentSchedule = scheduleData.find(d => d.day === activeDay);

  // ì•„ì´ì½˜ ë Œë”ë§ í—¬í¼
  const renderIcon = (type) => {
    const iconObj = ICON_TYPES.find(i => i.id === type) || ICON_TYPES[8]; // Default Map
    if (iconObj.custom) return <span className="font-bold text-lg">{iconObj.custom}</span>;
    const IconComponent = iconObj.icon;
    return <IconComponent className="w-5 h-5" />;
  };

  const getIconColor = (type) => {
    const iconObj = ICON_TYPES.find(i => i.id === type) || ICON_TYPES[8];
    return iconObj.color;
  };

  if (scheduleData.length === 0) return null; // ë¡œë”© ì¤‘

  return (
    <div className="min-h-screen bg-gray-50 flex justify-center font-sans">
      <div className="w-full max-w-md bg-white shadow-xl overflow-hidden min-h-screen sm:min-h-0 sm:h-[850px] sm:my-8 sm:rounded-3xl flex flex-col relative">
        
        {/* Header */}
        <div className="bg-slate-900 text-white p-6 pb-8 rounded-b-[2rem] shadow-lg z-10 relative">
          <div className="flex justify-between items-start mb-4">
            <div>
              <h1 className="text-2xl font-bold tracking-tight">ë‚˜ê°€ë…¸ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì—¬í–‰ ğŸ„</h1>
              <p className="text-slate-300 text-sm mt-1">12.24 - 12.28 (4ë°• 5ì¼)</p>
            </div>
            <button onClick={() => setIsSettingsOpen(!isSettingsOpen)} className="p-2 hover:bg-slate-800 rounded-full transition-colors">
              <Settings className="w-5 h-5 text-slate-400" />
            </button>
          </div>

          {/* Settings Menu */}
          {isSettingsOpen && (
            <div className="absolute right-6 top-16 bg-white text-slate-900 p-2 rounded-lg shadow-xl z-50 text-sm">
              <button onClick={handleReset} className="flex items-center w-full px-4 py-2 hover:bg-gray-100 rounded text-red-600">
                <RotateCcw className="w-4 h-4 mr-2" />
                ì´ˆê¸° ë°ì´í„°ë¡œ ë³µì›
              </button>
            </div>
          )}
          
          {/* Day Selector */}
          <div className="flex space-x-2 overflow-x-auto pb-2 scrollbar-hide">
            {scheduleData.map((day) => (
              <button
                key={day.day}
                onClick={() => setActiveDay(day.day)}
                className={`flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 whitespace-nowrap ${
                  activeDay === day.day
                    ? 'bg-white text-slate-900 shadow-md transform scale-105'
                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                }`}
              >
                {day.day}ì¼ì°¨
              </button>
            ))}
          </div>
        </div>

        {/* Content Area */}
        <div className="flex-1 overflow-y-auto px-4 py-6 -mt-4 z-0 pb-20">
          {currentSchedule && (
            <div className="animate-fade-in-up">
              <div className="flex items-center space-x-2 mb-6 ml-2">
                <Calendar className="w-5 h-5 text-slate-900" />
                <h2 className="text-lg font-bold text-gray-800">{currentSchedule.date}</h2>
                <span className="text-sm text-gray-500 line-clamp-1">| {currentSchedule.title}</span>
              </div>

              <div className="space-y-4">
                {currentSchedule.events.map((event, index) => (
                  <div key={event.id} className="flex relative group">
                    {/* Vertical Line */}
                    {index !== currentSchedule.events.length - 1 && (
                      <div className="absolute left-[19px] top-10 bottom-[-16px] w-0.5 bg-gray-200"></div>
                    )}

                    {/* Icon */}
                    <div className={`relative z-10 w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${getIconColor(event.type)} shadow-sm border-2 border-white`}>
                      {renderIcon(event.type)}
                    </div>

                    {/* Content Card */}
                    <div className="ml-4 flex-1 bg-white border border-gray-100 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200 relative">
                      
                      {/* Edit Button (Visible on Hover/Touch) */}
                      <button 
                        onClick={() => openEditModal(event)}
                        className="absolute top-3 right-3 p-1.5 text-gray-300 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors"
                      >
                        <Edit2 className="w-4 h-4" />
                      </button>

                      <div className="flex justify-between items-start mb-1 pr-6">
                        <div className="flex items-center text-indigo-600 font-bold text-sm bg-indigo-50 px-2 py-0.5 rounded-md">
                          <Clock className="w-3 h-3 mr-1" />
                          {event.time}
                          {event.endTime && ` - ${event.endTime}`}
                        </div>
                      </div>
                      
                      <h3 className="font-bold text-gray-800 text-lg leading-tight mb-1 pr-4">
                        {event.title}
                      </h3>
                      
                      <div 
                        onClick={() => event.mapQuery && handleLocationClick(event.mapQuery)}
                        className={`flex items-start text-sm mb-2 group-link ${event.mapQuery ? 'cursor-pointer' : ''}`}
                      >
                        <MapPin className="w-3.5 h-3.5 mr-1 mt-0.5 flex-shrink-0 text-gray-400 group-hover:text-blue-500 transition-colors" />
                        <span className={`leading-snug ${event.mapQuery ? 'text-gray-600 group-hover:text-blue-600 group-hover:underline decoration-blue-300 underline-offset-2' : 'text-gray-500'}`}>
                          {event.location || 'ì¥ì†Œ ì •ë³´ ì—†ìŒ'}
                        </span>
                        {event.mapQuery && <ExternalLink className="w-3 h-3 ml-1 mt-0.5 text-gray-300" />}
                      </div>

                      {event.note && (
                        <div className="bg-gray-50 rounded-lg p-2 text-xs text-gray-600 mt-2 border-l-2 border-indigo-200">
                          {event.note}
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              </div>

              {/* Add New Event Button */}
              <button 
                onClick={openAddModal}
                className="w-full mt-6 py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-400 font-medium hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2"
              >
                <Plus className="w-5 h-5" />
                ì¼ì • ì¶”ê°€í•˜ê¸°
              </button>
              
              <div className="text-center mt-8 mb-4 text-gray-400 text-xs">
                {activeDay === 5 ? "ì—¬í–‰ ì¢…ë£Œ! ğŸ " : "ì˜¤ëŠ˜ ì¼ì • ë! ğŸŒ™"}
              </div>
            </div>
          )}
        </div>

        {/* Edit/Add Modal */}
        {isEditModalOpen && editingEvent && (
          <div className="absolute inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in">
            <div className="bg-white w-full sm:w-[90%] sm:rounded-2xl rounded-t-2xl shadow-2xl p-6 max-h-[90%] overflow-y-auto">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold text-gray-900">
                  {scheduleData.find(d => d.day === activeDay).events.find(e => e.id === editingEvent.id) ? 'ì¼ì • ìˆ˜ì •' : 'ìƒˆ ì¼ì • ì¶”ê°€'}
                </h3>
                <button onClick={() => setIsEditModalOpen(false)} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                  <X className="w-5 h-5 text-gray-600" />
                </button>
              </div>

              <div className="space-y-4">
                {/* Time */}
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-semibold text-gray-500 mb-1">ì‹œì‘ ì‹œê°„</label>
                    <input 
                      type="time" 
                      value={editingEvent.time} 
                      onChange={(e) => setEditingEvent({...editingEvent, time: e.target.value})}
                      className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-semibold text-gray-500 mb-1">ì¢…ë£Œ ì‹œê°„ (ì„ íƒ)</label>
                    <input 
                      type="time" 
                      value={editingEvent.endTime} 
                      onChange={(e) => setEditingEvent({...editingEvent, endTime: e.target.value})}
                      className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                  </div>
                </div>

                {/* Title */}
                <div>
                  <label className="block text-xs font-semibold text-gray-500 mb-1">ì¼ì • ì œëª©</label>
                  <input 
                    type="text" 
                    value={editingEvent.title} 
                    onChange={(e) => setEditingEvent({...editingEvent, title: e.target.value})}
                    placeholder="ì˜ˆ: ë§›ì§‘ ë°©ë¬¸"
                    className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none font-medium"
                  />
                </div>

                {/* Location */}
                <div>
                  <label className="block text-xs font-semibold text-gray-500 mb-1">ì¥ì†Œëª…</label>
                  <input 
                    type="text" 
                    value={editingEvent.location} 
                    onChange={(e) => setEditingEvent({...editingEvent, location: e.target.value})}
                    placeholder="ì˜ˆ: ë„ì¿„ì—­"
                    className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none"
                  />
                </div>

                {/* Map Query (Hidden logic for user simplicity, but editable) */}
                <div>
                  <label className="block text-xs font-semibold text-gray-500 mb-1">êµ¬ê¸€ì§€ë„ ê²€ìƒ‰ì–´ (ìë™ ì—°ê²°ìš©)</label>
                  <input 
                    type="text" 
                    value={editingEvent.mapQuery} 
                    onChange={(e) => setEditingEvent({...editingEvent, mapQuery: e.target.value})}
                    placeholder="ì˜ˆ: Tokyo Station (ì˜ì–´ ì¶”ì²œ)"
                    className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                  />
                </div>

                {/* Note */}
                <div>
                  <label className="block text-xs font-semibold text-gray-500 mb-1">ë©”ëª¨</label>
                  <textarea 
                    value={editingEvent.note} 
                    onChange={(e) => setEditingEvent({...editingEvent, note: e.target.value})}
                    placeholder="ì¤€ë¹„ë¬¼, ì˜ˆì•½ë²ˆí˜¸ ë“±"
                    rows="2"
                    className="w-full p-3 bg-gray-50 rounded-xl border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                  />
                </div>

                {/* Type Selector */}
                <div>
                  <label className="block text-xs font-semibold text-gray-500 mb-2">ì•„ì´ì½˜ ì„ íƒ</label>
                  <div className="flex flex-wrap gap-2">
                    {ICON_TYPES.map((type) => (
                      <button
                        key={type.id}
                        onClick={() => setEditingEvent({...editingEvent, type: type.id})}
                        className={`w-10 h-10 rounded-full flex items-center justify-center transition-all ${
                          editingEvent.type === type.id 
                            ? `${type.color} ring-2 ring-offset-2 ring-indigo-500 scale-110` 
                            : 'bg-gray-100 text-gray-400 hover:bg-gray-200'
                        }`}
                      >
                        {type.custom ? type.custom : <type.icon className="w-5 h-5" />}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Buttons */}
                <div className="flex gap-3 mt-6 pt-4 border-t border-gray-100">
                  {scheduleData.find(d => d.day === activeDay).events.find(e => e.id === editingEvent.id) && (
                    <button 
                      onClick={handleDeleteEvent}
                      className="flex-1 p-3 bg-red-50 text-red-600 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-red-100"
                    >
                      <Trash2 className="w-5 h-5" /> ì‚­ì œ
                    </button>
                  )}
                  <button 
                    onClick={handleSaveEvent}
                    className="flex-[2] p-3 bg-slate-900 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-800 shadow-lg shadow-slate-200"
                  >
                    <Save className="w-5 h-5" /> ì €ì¥í•˜ê¸°
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
      <style>{`
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
        .animate-fade-in { animation: fadeInUp 0.2s ease-out forwards; }
      `}</style>
    </div>
  );
}